<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>{% block title %}{% endblock %} - movaro</title>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css', v=now_timestamp) }}">
    
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico', v=now_timestamp) }}">
    
    {% block head %}{% endblock %}
</head>
<body>
    <script>
        // Script para evitar el "parpadeo" del tema claro al cargar la p√°gina
        (function() {
            const theme = localStorage.getItem('theme') || 'dark';
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
            }
        })();
    </script>

    {% if session.usuario_id %}
    <nav class="navbar">
        <div class="brand">
            <a href="/panel">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo movaro" height="40">
            </a>
        </div>
        <div class="desktop-links">
            <a href="/panel">Panel</a>
            <a href="/calendario">Agenda</a>
            <a href="/clientes">Clientes</a>
            <a href="/estadisticas">Estad√≠sticas</a>
            <a href="/servicios">Mis Servicios</a> 
            <a href="/horarios">Mi Horario</a> 
            <a href="/configuracion_publica">Calendario Publico</a>
            <a href="/mensajes">Mis Mensajes</a>  
            <a href="/campanas">Campa√±as</a>
            <a href="/logout">Cerrar Sesi√≥n</a>
        </div>
        <div class="nav-actions">
            <button id="theme-toggle" class="theme-toggle-btn">üåô</button>
            <button class="hamburger" aria-label="Abrir men√∫">&#9776;</button>
        </div>
    </nav>

    <!-- Panel lateral deslizable -->
    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn">&times;</a>
        <a href="/panel">Panel</a>
        <a href="/calendario">Agenda</a>
        <a href="/clientes">Clientes</a>
        <a href="/estadisticas">Estad√≠sticas</a>
        <a href="/servicios">Mis Servicios</a> 
        <a href="/horarios">Mi Horario</a> 
        <a href="/configuracion_publica">Calendario Publico</a>
        <a href="/mensajes">Mis Mensajes</a>  
        <a href="/campanas">Campa√±as</a>
        <a href="/logout">Cerrar Sesi√≥n</a>
    </div>
    {% endif %}

    <div class="container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alerta flash-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        {% block content %}{% endblock %}
    </div>

    <script>
        // --- L√ìGICA DEL MEN√ö LATERAL ---
        const hamburger = document.querySelector('.hamburger');
        const sidenav = document.getElementById('mySidenav');
        const closeBtn = document.querySelector('.closebtn');

        if (hamburger && sidenav && closeBtn) {
            hamburger.addEventListener('click', () => {
                if (sidenav.style.width === '250px') {
                    sidenav.style.width = '0';
                } else {
                    sidenav.style.width = '250px';
                }
            });

            closeBtn.addEventListener('click', () => {
                sidenav.style.width = '0';
            });

            window.addEventListener('click', (event) => {
                if (event.target == sidenav) {
                    sidenav.style.width = '0';
                }
            });
        }

        // --- L√ìGICA DEL MODO OSCURO ---
        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
            // Actualizar el √≠cono al cargar la p√°gina
            if (document.body.classList.contains('dark-mode')) {
                themeToggle.textContent = '‚òÄÔ∏è';
            }

            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                
                let theme = 'light';
                let icon = 'üåô';
                if (document.body.classList.contains('dark-mode')) {
                    theme = 'dark';
                    icon = '‚òÄÔ∏è';
                }
                localStorage.setItem('theme', theme);
                themeToggle.textContent = icon;
            });
        }
    </script>
    <script src="{{ url_for('static', filename='upload_handler.js', v=now_timestamp) }}"></script>
</body>
</html>