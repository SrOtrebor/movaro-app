{% extends "base.html" %}

{% block title %}Detalle de {{ clienta.nombre }} {{ clienta.apellido }}{% endblock %}

{% block content %}
<a href="/clientes">← Volver al listado de clientes</a>
<hr>

<div class="layout-container">
    <div class="layout-col-lateral">
        <div class="card">
            <div style="text-align: center; margin-bottom: 20px;">
                {% if clienta.avatar_path %}
                    <img src="{{ url_for('static', filename='uploads/' + clienta.avatar_path) }}" alt="Avatar" style="width:120px; height:120px; border-radius:50%; object-fit:cover;">
                {% else %}
                    <img src="{{ url_for('static', filename='placeholder.png') }}" alt="Avatar por defecto" style="width:120px; height:120px; border-radius:50%; object-fit:cover;">
                {% endif %}
            </div>
            <h2>{{ clienta.nombre }} {{ clienta.apellido }}</h2>
            <p><strong>Teléfono:</strong> {{ clienta.telefono or 'No especificado' }}</p>
            <p><strong>Cumpleaños:</strong> {{ clienta.cumpleanos or 'No especificado' }}</p>

            <hr style="margin: 20px 0;">

            <form action="/subir_avatar" method="post" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="avatar">Cambiar foto de perfil:</label>
                    <input type="hidden" name="cliente_id" value="{{ clienta.id }}">
                    <input type="file" id="avatar" name="avatar" accept="image/*" required>
                </div>
                <button type="submit" style="width:100%;">Subir Foto</button>
            </form>
        </div>
    </div>

    <div class="layout-col-principal">
        <h2>Historial de Turnos</h2>
        {% if turnos %}
            {% for turno in turnos %}
                <div class="card" style="margin-bottom: 20px;">
                    <h4>Turno del {{ turno.fecha }} a las {{ turno.hora }}</h4>
                    <p><strong>Servicio:</strong> {{ turno.servicio_nombre }}</p>
                    
                    <div style="display:flex; gap: 20px; align-items: flex-start;">
                        {% if turno.foto_path %}
                            <div>
                                <p><strong>Foto del trabajo:</strong></p>
                                <img src="{{ url_for('static', filename='uploads/' + turno.foto_path) }}" alt="Foto del trabajo" style="border-radius: var(--border-radius);">
                            </div>
                        {% endif %}
                        
                        <div style="flex-grow: 1;">
                            <form action="/subir_foto" method="post" enctype="multipart/form-data">
                                <div class="form-group">
                                    <label for="foto-{{ turno.id }}">
                                        {% if turno.foto_path %}Cambiar foto{% else %}Subir foto{% endif %} del trabajo:
                                    </label>
                                    <input type="hidden" name="turno_id" value="{{ turno.id }}">
                                    <input type="hidden" name="cliente_id" value="{{ clienta.id }}">
                                    <input type="file" id="foto-{{ turno.id }}" name="foto" accept="image/*" required>
                                </div>
                                <button type="submit">Guardar</button>
                            </form>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="card">
                <p>Este cliente aún no tiene turnos registrados.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}